<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Descargar YouTube</title>
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        input, button { padding: 10px; margin: 5px; }
        #modal {
            display: none;
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            justify-content: center; align-items: center;
        }
        #modal-content {
            background: #fff; padding: 20px; border-radius: 10px;
            text-align: center; width: 300px;
        }
        .loader {
            border: 6px solid #f3f3f3;
            border-top: 6px solid #3498db;
            border-radius: 50%;
            width: 40px; height: 40px;
            animation: spin 1s linear infinite;
            margin: 10px auto;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <h2>Descargar de YouTube</h2>
    <form id="downloadForm">
        <input type="text" name="url" placeholder="Pega el enlace de YouTube" required><br><br>
        <label><input type="radio" name="format" value="mp3" checked> MP3</label>
        <label><input type="radio" name="format" value="mp4"> MP4</label><br><br>
        <button type="submit">Descargar</button>
    </form>

    <!-- Modal -->
    <div id="modal">
        <div id="modal-content">
            <h3 id="status">Descargando...</h3>
            <div class="loader"></div>
            <p id="progress">0%</p>
        </div>
    </div>

    <script>
        const socket = io(); // Se conecta automáticamente al backend
        const modal = document.getElementById("modal");
        const statusText = document.getElementById("status");
        const progressText = document.getElementById("progress");

        // Escucha los eventos de progreso desde Flask-SocketIO
        socket.on("progress", (data) => {
            progressText.innerText = data.progress + "%";
            if (data.status === "finished") {
                statusText.innerText = "Descarga exitosa ✅";
            }
        });

        // Manejar envío del formulario
        document.getElementById("downloadForm").addEventListener("submit", function(e) {
            e.preventDefault();

            // Mostrar modal
            modal.style.display = "flex";
            statusText.innerText = "Descargando...";
            progressText.innerText = "0%";

            const formData = new FormData(this);

            fetch("/download", {
                method: "POST",
                body: formData
            })
            .then(resp => {
                if (!resp.ok) throw new Error("Error en el servidor");
                return resp.blob();
            })
            .then(blob => {
                // Descargar el archivo en el navegador
                let url = window.URL.createObjectURL(blob);
                let a = document.createElement("a");
                a.href = url;
                a.download = formData.get("format") === "mp3" ? "audio.mp3" : "video.mp4";
                document.body.appendChild(a);
                a.click();
                a.remove();
                window.URL.revokeObjectURL(url);

                statusText.innerText = "Descarga completada ✅";
            })
            .catch(err => {
                statusText.innerText = "❌ Error: " + err.message;
                progressText.innerText = "0%";
            });
        });
    </script>
</body>
</html>








